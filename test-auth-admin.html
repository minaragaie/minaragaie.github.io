<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e1e1e; color: #d4d4d4; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcb67a; }
        button { padding: 10px 15px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a9e; }
        input { padding: 8px; margin: 5px; background: #2d2d30; color: #d4d4d4; border: 1px solid #555; border-radius: 3px; }
        .log { background: #0d1117; padding: 10px; border-radius: 3px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üß™ Admin Functionality Test</h1>
    
    <div class="test-section">
        <h2>1. Authentication Test</h2>
        <p>Test the authentication flow with correct credentials:</p>
        <input type="text" id="username" placeholder="Username" value="minayouaness">
        <input type="password" id="password" placeholder="Password" value="Qwerty100">
        <button onclick="testAuth()">Test Authentication</button>
        <div id="auth-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>2. Admin Page Access Test</h2>
        <button onclick="testAdminAccess()">Test Admin Page Access</button>
        <div id="admin-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3. Input Performance Test</h2>
        <button onclick="testInputPerformance()">Test Input Performance</button>
        <div id="performance-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4. CRUD Operations Test</h2>
        <button onclick="testCRUD()">Test CRUD Operations</button>
        <div id="crud-result" class="log"></div>
    </div>

    <script>
        const API_BASE = 'https://resume-backend-service.vercel.app';
        const LOCAL_BASE = 'http://localhost:3000';

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            element.textContent += `[${timestamp}] ${prefix} ${message}\n`;
        }

        async function testAuth() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('auth-result');
            resultDiv.textContent = '';

            log('auth-result', `Testing authentication with username: ${username}`);
            
            try {
                // Test the auth endpoint
                const response = await fetch(`${API_BASE}/api/admin-auth`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    log('auth-result', `Authentication successful! Token: ${data.token ? 'Received' : 'Not received'}`, 'success');
                    localStorage.setItem('admin_token', data.token);
                    localStorage.setItem('admin_username', username);
                } else {
                    log('auth-result', `Authentication failed: ${data.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                log('auth-result', `Authentication error: ${error.message}`, 'error');
            }
        }

        async function testAdminAccess() {
            const resultDiv = document.getElementById('admin-result');
            resultDiv.textContent = '';

            log('admin-result', 'Testing admin page access...');
            
            try {
                // Test if we can access the admin endpoint
                const token = localStorage.getItem('admin_token');
                if (!token) {
                    log('admin-result', 'No token found. Please authenticate first.', 'warning');
                    return;
                }

                const response = await fetch(`${API_BASE}/api/admin?type=resume`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    log('admin-result', `Admin access successful! Resume data: ${data.success ? 'Loaded' : 'Failed to load'}`, 'success');
                } else {
                    log('admin-result', `Admin access failed: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                log('admin-result', `Admin access error: ${error.message}`, 'error');
            }
        }

        async function testInputPerformance() {
            const resultDiv = document.getElementById('performance-result');
            resultDiv.textContent = '';

            log('performance-result', 'Testing input performance...');
            
            // Open admin page in new window
            const adminWindow = window.open(`${LOCAL_BASE}/admin`, '_blank');
            
            if (adminWindow) {
                log('performance-result', 'Admin page opened in new window. Please test typing performance manually.', 'warning');
                log('performance-result', 'Look for: 1) Smooth typing 2) No console violations 3) No lag');
            } else {
                log('performance-result', 'Failed to open admin page (popup blocked?)', 'error');
            }
        }

        async function testCRUD() {
            const resultDiv = document.getElementById('crud-result');
            resultDiv.textContent = '';

            log('crud-result', 'Testing CRUD operations...');
            
            const token = localStorage.getItem('admin_token');
            if (!token) {
                log('crud-result', 'No token found. Please authenticate first.', 'warning');
                return;
            }

            try {
                // Test updating resume data
                const testData = {
                    personalInfo: {
                        name: 'Test User',
                        title: 'Test Developer',
                        email: 'test@example.com',
                        phone: '+1234567890',
                        location: 'Test City',
                        summary: 'Test summary'
                    },
                    skills: {
                        technical: ['React', 'Node.js', 'Test'],
                        soft: ['Communication', 'Teamwork']
                    }
                };

                const response = await fetch(`${API_BASE}/api/admin?type=resume`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    const data = await response.json();
                    log('crud-result', `CRUD test successful! Response: ${data.success ? 'Success' : 'Failed'}`, 'success');
                } else {
                    const errorData = await response.json();
                    log('crud-result', `CRUD test failed: ${response.status} - ${errorData.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                log('crud-result', `CRUD test error: ${error.message}`, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('auth-result', 'Authentication test ready. Click "Test Authentication" to begin.');
            log('admin-result', 'Admin access test ready. Authenticate first, then test admin access.');
            log('performance-result', 'Performance test ready. This will open the admin page for manual testing.');
            log('crud-result', 'CRUD test ready. Authenticate first, then test CRUD operations.');
        });
    </script>
</body>
</html>

